# AlgoTrader
A Library for Algorithmic Trading in Python

AlgoTrader simplifies the process of developing and deploying trading algorithms. The user can write a custom trading algorithm by extending the Algo class, which provides methods for fetching historical stock data, accessing account information, and placing trades. The development process can be informed by AlgoTrader's backtest functionality, which allows the user to test how their algorithm would have performed on a given date range. Once finished, the user can deploy their algorithm (either in "live" or "paper trading" mode) by spinning up a local AlgoTrader server, which runs algorithms and logs metrics on a user-specified schedule. Multiple algorithms can be run concurrently, and individual algorithms can be added, paused, or removed while the server is running.

## Installation
``` bash
git clone https://github.com/Acciorocketships/AlgoTrader
cd AlgoTrader
python3 -m pip install -e .
```

## Example
```python

## Define Strategy ##
class MACDstrategy(Algo):

        # automatically called when the strategy is initialised
	def init(self):
                # set cron schedule (as a dict or list of dicts)
		self.set_schedule({"second": 5, "minute": 30, "hour": 9, "day_of_week": "mon-fri"})

        # automatically called according to the schedule that has been set
	def run(self):
                # get data to compute technical indicators
		hist = self.get_data("SPY", days=50)
                # filter the desired times
		if self.data.timeframe == 'minute':
			hist = hist.at_time(datetime.time(9,30))
                # calculate macd tecnical indicator
		macd = ta.trend.macd_diff(hist, window_slow=26, window_fast=12, window_sign=9)[-1]
                # order logic
		if macd > 0:
			self.order_target_percent("SPY", 1.0) # order such that SPY represents 100% of the portfolio value
		else:
			self.order_target_percent("SPY", 0.0) # order such that SPY represents 0% of the portfolio value
			self.cancel_orders("SPY")
      
      
## Backtest ##
# fetch data for SPY stock from 1 Oct 2018 to 1 Aug 2021
data = AlpacaData(start=datetime.datetime(2018,10,1), end=datetime.datetime(2021,8,1), timeframe='day', symbols=["SPY"])
# init algo and manager, and add algo to manager
backtest_manager = Manager(data)
backtest_algo = MACDstrategy()
backtest_manager.add_algo(backtest_algo)
# start backtest
backtest_manager.backtest(start=datetime.datetime(2019,1,1), end=datetime.datetime(2021,8,1))


## Live Trade ##
# fetch SPY data going back 60 days from today
data = AlpacaData(start=60, timeframe='day', symbols=["SPY"])
# init algo and manager, and add algo to manager
manager = Manager(data)
algo = MACDstrategy()
manager.add_algo(algo)
# start live trading
manager.run()

```

## Backtesting

Backtesting returns a dict with the following metrics:
* [Sharpe](https://www.investopedia.com/terms/s/sharperatio.asp)
* [Sortino](https://www.investopedia.com/terms/s/sortinoratio.asp)
* [Alpha](https://www.investopedia.com/terms/a/alpha.asp)
* [Beta](https://www.investopedia.com/terms/b/beta.asp)
* [Compound Annual Growth Rate](https://www.investopedia.com/terms/c/cagr.asp)
* [Max Drawdown](https://www.investopedia.com/terms/m/maximum-drawdown-mdd.asp)
* [Average Win](https://www.investopedia.com/terms/p/profit_loss_ratio.asp)
* [Average Loss](https://www.investopedia.com/terms/p/profit_loss_ratio.asp)
* [Win Rate](https://www.investopedia.com/terms/w/win-loss-ratio.asp)
* [Total Return](https://www.investopedia.com/terms/t/totalreturn.asp)

It also creates an html tearsheet generated by QuantStats:

![Cumulative Returns](https://github.com/Acciorocketships/AlgoTrader/blob/main/images/cumulativereturns.png)
![Monthly Returns](https://github.com/Acciorocketships/AlgoTrader/blob/main/images/monthlyreturns.png)


## API Reference

### Broker

The broker class handles all trades and fetches account information. The default broker is Alpaca, but a custom broker can easily be implemented.

1. ```broker.order()
